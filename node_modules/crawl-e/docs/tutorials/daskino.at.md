# How to build a single cinema crawler

This tutorial teaches how to build showtimes crawler for a simple website listing showtimes for a single cinema using as example http://www.daskino.at/.

First setup the project as described in [here](/quickstart?id=project-setup) and read the [Terminology basics](basics/terminology).

## 1. Create a script file

Name it `at_at-daskino.js` and import `CrawlE`.


## 2. Configure the cinema

Since the crawler covers only one cinemas it's not worth putting in any development effort into crawling it's data. Instead simply hard code it as following:

```javascript
let crawlE = new CrawlE({
  cinemas: [
    {
      name: 'DAS KINO',
      address: 'Giselakai 11, A-5020 Salzburg',
      website: 'http://www.daskino.at/',
      phone: '0662-87 31 00'
    }
  ]
})
crawlE.crawl()
```

Running the script should print a log message: `found 1 cinemas`.

?> Running the script with either addional environment variable `DEBUG=*` or appending `-v` prints the configured cinema. [Learn about debug logs](/basics/debug-logs).

## 3. Configure the showtimes crawling

### Showtimes URL Template

The example cinema lists all showtimes or one page.


Add a `showtimes` object on the same level as `cinemas` and set the url template and it's date format for the pages listing showtimes.

```javascript
let crawlE = new CrawlE({
  cinemas: [
    // …
  ],
  showtimes: {
    url: 'https://www.daskino.at/programm/',
  }
}
crawlE.crawl()
```

Running the crawler script, it should now log request to the showtimes url.

### Parsing Movies

For parsing the showtimes the configuration is structured according to the source website. In case of this example website is structured using a HTML `div` with class `.movie-list-item` which has a data for each movie. So we start by grabbing this `divs` as movies boxes.

First add only the `box` selector (as below) and check the script logs messages like `CrawlE:selection:movies:count found 7 boxes` for each day. Then add a selector for the title and check the `movies:result` logs.

```javascript
let crawlE = new CrawlE({
  cinemas: [
    // …
  ],
  showtimes: {
    url: 'http://www.daskino.at/programm_:date:',
    movies: {
      box: '.movie-list-item',
      title: 'header > h3 > a',
    }
  }
})
crawlE.crawl()
```

### Parsing Showtimes

Next for getting the showtimes the framework will search for showtime boxes within a showtimes container. In case of this example each movie box also is a showtimes container. Reflecting this website's structure in the configuration add a 2nd `showtimes` config inside the `movies` config. It always needs a `box` selector. In this example however we need to specify some more selectors. We need to find specific box with showtimes. In our case it is a `div` inside movie `.movie-list-item` box that is a div with class `.movieTimes`. Inside of it we can see that date are with class `.day`. As the date format is not default ISO format we need to add `dateLocale` to not use default `en` language. Then also `dateFormat` so crawlE will understand how to parse this date. Time is in class `.datetime` but as we can see it is containing some extra information like word `Ticket` and auditorium. When possible we should also set this information. To make it nice we need to use custom [value grabber](/basics/value-grabber) with [mapper](/basics/terminology?id=mapper) to clean it. Inside of it we are removing not needed word `Ticket` and picking first part of array generated by split to get show times only. The date of the is pulled from the context of iterating over them as described above. Both these values (date and time) get combined into each showtime's `start_at` property.

In similar way as with timewe are working with auditorium but in that case we are selecting second element of that array.
As we have booking links as `a` in `.datetime @href` we are picking them too when possible. In this case we will be using [short-handle](/basics/value-grabber?id=short-handle)

```javascript
let crawlE = new CrawlE({
  cinemas: [
    // …
  ],
  showtimes: {
    url: 'https://www.daskino.at/programm/',
    movies: {
      box: '.movie-list-item',
      title: 'header > h3 > a',
      showtimes: {
        box: '.movieTimes',
        date: '.day',
        dateFormat: 'dd, D. MMMM',
        dateLocale: 'de',
        time: {
          selector: '.datetime',
          mapper: value => value.replace('Ticket', '').split(' ')[0].trim()
        },
        auditorium: {
          selector: '.datetime',
          mapper: value => value.replace('Ticket', '').split(' ')[1].trim()
        },
        attributes: '.datetime .specials a span',
        booking_link: '.datetime a @href'
      }
    }
  }
})
crawlE.crawl()
```

Run the script again and check the outputs.